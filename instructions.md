# Prompt

Create a brand new global messaging app using the T3 stack (Next.js, TypeScript, Tailwind CSS, tRPC, Prisma).

## Technical Requirements

### T3 Stack Setup (2025 Edition)

- Use `create-t3-app@latest` to scaffold the project with Next.js 15 and React 19
- Include TypeScript, Tailwind CSS, tRPC v11, and Prisma
- Skip NextAuth.js (no authentication needed for this simple app)
- Use SQLite database for local development (configured in Prisma schema)
- Enable React 19 stable support and App Router optimizations
- Configure Turbopack for faster development (stable in Next.js 15)

### Database Schema

- Create a `Message` table with fields:
  - `id` (auto-increment primary key)
  - `content` (text, max 500 characters)
  - `username` (string, max 50 characters)
  - `createdAt` (timestamp)
  - `color` (string, hex color code for the username)

### Real-time Updates

- Implement polling every 2 seconds to fetch new messages
- Display messages in real-time as they're posted
- Use `useEffect` with `setInterval` to poll for new messages

### Username System

- Generate random usernames using format: `adjective + noun + 3-digit number` (e.g., "HappyPanda123")
- Store username in localStorage to persist across browser sessions
- Allow users to click their username to edit it (validate: 3-50 characters, alphanumeric only, no spaces)

### Message Features

- Messages limited to 500 characters
- Each user gets a random bright color from predefined palette: `#FF6B6B`, `#4ECDC4`, `#45B7D1`, `#96CEB4`, `#FFEAA7`, `#DDA0DD`, `#98D8C8`, `#F7DC6F` (assigned when username is generated)
- Show timestamp in "HH:MM" format (24-hour)
- Display messages in chronological order (newest at bottom)

## User Journey

1. User visits webpage and sees existing messages from previous visitors
2. User is assigned a random username (displayed at top of chat)
3. User can click username to edit it
4. User types message (character counter shows remaining characters)
5. User clicks "Send" button to post message
6. Message appears immediately in chat with user's assigned color
7. New messages from other users appear automatically

## UI Design

### Layout

- Full-screen chat interface
- Header with app title and editable username
- Message area (scrollable, auto-scroll to bottom)
- Input area at bottom with text input and send button

### Message Display

- Twitch-style chat messages
- All messages left-aligned in a single column
- Each message format: `[HH:MM] username: message content`
- Username displayed in the assigned color, message content in white/light text
- No message bubbles - simple text-based layout
- Alternating subtle background colors for better readability

### Color Scheme

- Background: Dark theme similar to Twitch (`#18181B` or `#1F1F23`)
- Input area: Dark background (`#2F2F35`) with subtle border
- Send button: Purple (`#9146FF`) with hover effect
- Username colors: Use predefined bright palette for usernames only
- Message text: Light gray (`#EFEFF1`) for readability
- Timestamps: Muted gray (`#ADADB8`)

### Responsive Design

- Mobile-first approach
- Minimum width: 320px
- Maximum width: 800px (centered on desktop)
- Compact message spacing for chat-like feel
- Fixed-width font for timestamps to maintain alignment

## Error Handling

- Show loading states during message sending
- Display error messages for failed requests
- Validate message length before sending
- Handle network errors gracefully

## Project Structure

```
src/
├── components/
│   ├── ChatInput.tsx
│   ├── MessageItem.tsx
│   ├── MessageList.tsx
│   └── UsernameEditor.tsx
├── hooks/
│   └── useMessagePolling.ts
├── pages/
│   ├── _app.tsx
│   ├── index.tsx
│   └── api/
├── server/
│   └── api/
│       └── routers/
│           └── message.ts
├── utils/
│   ├── username.ts
│   └── messages.ts
└── styles/
    └── globals.css
```

## Setup Checklist

### Initial Setup Steps
1. Run `npm create t3-app@latest` with required options
2. Create `.gitignore` file with Node.js/Next.js patterns
3. Create `.prettierrc` for code formatting
4. Create `.env.example` template
5. Set up ESLint config with `eslint.config.js`
6. Configure Vitest with `vitest.config.ts`
7. Set up Playwright with `playwright.config.ts`
8. Initialize Husky for Git hooks
9. Configure commitlint for conventional commits

### Files That Must Be Created
- `.gitignore` - Git ignore patterns
- `.prettierrc` - Prettier configuration
- `.env.example` - Environment variables template
- `.env.local` - Local environment variables (not committed)
- `eslint.config.js` - ESLint flat config
- `vitest.config.ts` - Test configuration
- `playwright.config.ts` - E2E test configuration
- `commitlint.config.js` - Commit message linting
- `next.config.ts` - Next.js configuration

### Files Generated by Tools
- `tsconfig.json` - TypeScript configuration (create-t3-app)
- `package.json` - Dependencies and scripts
- `package-lock.json` - Lock file for dependencies
- `.husky/pre-commit` - Git pre-commit hooks
- `README.md` - Project documentation

## Git Workflow

Commit after each major milestone:

1. Initial T3 app setup and configuration files
2. Database schema and Prisma setup
3. Basic UI components
4. tRPC API routes
5. Real-time messaging functionality
6. Username system
7. Final styling and polish

## Deployment

- Deploy to Vercel (not GitHub Pages, since this is a full-stack app)
- Use Vercel's built-in PostgreSQL database for production
- Update README.md with live demo link
- Deploy using Vercel CLI or GitHub integration

## Testing & Quality Tools

### Testing Strategy (2025 Updated)

- **Unit Tests**: Vitest 3.0 + React Testing Library 16 for component and utility testing
- **E2E Tests**: Playwright 1.50+ for full user journey testing with improved browser support
- **API Tests**: Supertest 7.0 for tRPC v11 route testing
- **Component Tests**: Testing Library with MSW 2.8 for API mocking
- **Test Coverage**: Aim for 80%+ coverage on business logic
- **Performance**: Vitest 3.0 offers 2-5x faster test execution and improved reporting

### Code Quality Tools

- **ESLint**: TypeScript-specific rules with strict configuration
- **Prettier**: Code formatting with consistent style
- **Husky**: Git hooks for pre-commit quality checks
- **lint-staged**: Run linters only on staged files
- **Commitizen**: Conventional commit message formatting
- **TypeScript**: Strict mode with comprehensive type checking

### Development Tools

- **Storybook**: Component development and documentation
- **Bundle Analyzer**: Optimize bundle size and identify bloat
- **Pre-commit Hooks**: Type checking, linting, and formatting
- **Vitest UI**: Interactive test runner interface

### Package.json Scripts

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "test": "vitest",
    "test:watch": "vitest --watch",
    "test:ui": "vitest --ui",
    "test:e2e": "playwright test",
    "test:e2e:ui": "playwright test --ui",
    "lint": "eslint . --ext .ts,.tsx,.js,.jsx",
    "lint:fix": "eslint . --ext .ts,.tsx,.js,.jsx --fix",
    "type-check": "tsc --noEmit",
    "format": "prettier --write .",
    "format:check": "prettier --check .",
    "prepare": "husky install",
    "storybook": "storybook dev -p 6006",
    "build-storybook": "storybook build"
  }
}
```

### Required Dev Dependencies (2025 Updated)

```json
{
  "devDependencies": {
    "@playwright/test": "^1.50.0",
    "@storybook/react": "^8.4.0",
    "@testing-library/react": "^16.1.0",
    "@testing-library/jest-dom": "^6.6.0",
    "@testing-library/user-event": "^14.5.0",
    "@commitlint/cli": "^19.8.0",
    "@commitlint/config-conventional": "^19.8.0",
    "@typescript-eslint/eslint-plugin": "^8.18.0",
    "@typescript-eslint/parser": "^8.18.0",
    "eslint": "^9.18.0",
    "eslint-config-next": "^15.1.0",
    "eslint-config-prettier": "^9.1.0",
    "eslint-plugin-react": "^7.37.0",
    "eslint-plugin-react-hooks": "^5.0.0",
    "husky": "^9.1.0",
    "lint-staged": "^15.2.0",
    "msw": "^2.8.0",
    "prettier": "^3.4.0",
    "supertest": "^7.0.0",
    "vitest": "^3.0.0",
    "@vitejs/plugin-react": "^4.3.0"
  }
}
```

### Configuration Files (2025 Updated)

- `eslint.config.js`: Modern flat config for ESLint 9 with TypeScript support
- `.prettierrc`: Consistent code formatting rules
- `vitest.config.ts`: Vitest 3.0 configuration with enhanced workspace support
- `playwright.config.ts`: Playwright 1.50+ configuration for improved browser testing
- `.husky/pre-commit`: Git hooks for quality checks
- `commitlint.config.js`: Conventional commit enforcement
- `next.config.ts`: TypeScript support for Next.js 15 configuration
- `.gitignore`: Git ignore patterns for Node.js and Next.js projects
- `.env.example`: Template for environment variables
- `tsconfig.json`: TypeScript compiler configuration (generated by create-t3-app)

### Essential Configuration File Contents

#### .gitignore
```
node_modules/
.next/
.env*.local
.vercel
*.log
.DS_Store
dist/
build/
coverage/
.nyc_output/
.turbo/
```

#### .prettierrc
```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "tabWidth": 2,
  "useTabs": false,
  "printWidth": 80,
  "bracketSpacing": true,
  "arrowParens": "always"
}
```

#### .env.example
```
# Database
DATABASE_URL="file:./db.sqlite"

# Next.js
NEXT_PUBLIC_APP_URL="http://localhost:3000"

# Optional: Analytics, monitoring, etc.
# VERCEL_ANALYTICS_ID=""
```

## Documentation

- README.md with setup instructions, tech stack overview, and live demo link
- Include screenshots of the app
- Document API endpoints and database schema
- Add troubleshooting section

## Future Improvements

- **Real-time Subscriptions**: Replace polling with tRPC subscriptions for instant message delivery and reduced server load
